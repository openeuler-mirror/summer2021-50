# 项目中期报告

## 项目信息

- ### 项目名称：openEuler平台下基于secGear框架的数字作品权属保护

- ### 方案描述：

  数字版权保护涉及的范围比较广泛，但由于时间和工作量等问题，本项目选择聚焦目前数字作品中最为重要的数字图像，以其为项目的开发的重点，进行更加深入地研发工作。在项目完成后，总结相关经验，应用于其他的数字作品中。同时，项目聚焦数字作品权属保护中的一个核心环节，即数字作品权属认定过程，希望通过隐式水印的方式实现对数字作品权属的认定，以实现对数字作品权属的保护。

  1. #### 协议方案

     本项目结合secGear机密计算框架的实现原理及特点，将数字图像版权保护的工作流程进行细化和拆分，将部分关键步骤进行抽离和处理，形成一套针对数字版权保护且具有更高安全性的协议，具有较强创新性。同时，在开题报告的基础上，我对协议进行了优化和修改，以提高整体工作流程的效率。目前，协议主要分为加水印和解水印两个主要阶段。

  2. #### 前端方案

     根据项目的整体设计方案，为了大幅度减轻服务器负载，提高平台工作效率并且保障信息传输过程中的安全性，平台的大部分工作计划在前端进行实现，后端仅会对部分核心步骤进行实现。同时，项目对开题报告的前端方案进行了修改，将网页端修改为本地端的应用程序形式，简化了用户交互的过程。

  3. #### 后端方案

     根据设计的协议，项目将采用前后端分离的形式进行开发，并且将前后端分别装载在前端服务器和后端服务器上。为了全面展现 secGear的特性，对于后端服务器，本项目将使用搭载鲲鹏处理器的华为云服务器作为后端服务器，并且使用openEuler作为操作系统。后端的web应用层将使用python语言，通过Flask框架进行编写，为前端的请求提供服务接口。同时，将搭建uWSGI和Nginx对web应用层进行部署，实现高并发、负载均衡和反向代理等功能，保证平台服务能顺利进行。

- ### 时间规划：

  - #### 7.1-7.15：

    - 收集和学习secGear及机密计算框架相关资料
    - 收集和学习openEular系统相关资料
    - 收集和学习数字权属保护相关资料
    - 收集和学习数字图像处理及隐式水印相关资料
    - 制定和修改项目开展方案
    - 环境安装及配置
      - openEular系统安装及配置
      - secGear框架及相关环境安装及配置
      - Flask、Nginx等服务器环境安装及配置
      - 客户端开发环境安装及配置

  - #### 7.16-7.23：

    - 协议核心步骤基础部分开发（secGear框架内）
      - 大端数据类：满足哈希算法的要求
      - 小端数据类：任意精度整数类
      - SHA256哈希算法原生实现
      - RSA解密算法实现

  - #### 8.1-8.15：

    - 协议核心步骤实用部分开发（secGear框架内）
      - 初始化服务器：
        - 输入：D、N
        - 返回：CD、CKu、 CKw（初始化参数）
      - 生成加密密码：
        - 输入：CPW, CD, N, Ku
        - 返回：NPW
      - 生成水印参数：
        - 输入：CWID, NPW, CD, N, Ku, Kw
        - 返回：x, mu, k（水印参数） 
    - 后端服务器开发（Flask框架）

## 项目进度

- ### 已完成工作：

  1. #### openEular系统搭建

  2. #### secGear框架搭建

  3. #### Flask、Nginx等服务器环境搭建

  4. #### 客户端开发环境搭建

  5. #### 项目开展方案

     1. **协议方案**

        

  6. #### 协议核心步骤基础部分

     1. **大端数据类**
        - FromU32()：将无符号整型数转换为bigNum
        - hex()：转换为十六进制字符串
        - bin()：转换为二进制字符串
        - 重载 除运算
        - 重载 幂运算
     2. **小端数据类**
        - fromBin()：将二进制转换为smallNum
        - fromBigNum()：将bigNum转换为smallNum
        - fromU32()：将无符号整型数转换为smallNum
        - fromDec()：将十进制转换为smallNum
        - toBigNum()：转换为bigNum
        - hex()：转换为十六进制字符串
        - bin()：转换为二进制字符串
        - pow()：幂运算
        - pow_mod()：快速幂取模运算
        - 重载 加运算
        - 重载 乘运算
        - 重载 幂运算
        - 重载 模运算
        - 重载 判断符
     3. **SHA256哈希算法（函数）**
     4. **RSA解密算法（函数）**

  7. ####  协议核心步骤实用部分

     1. **初始化服务器（函数）**

        - 输入：D、N
        - 返回：CD、CKu、 CKw（初始化参数）

     2. **生成加密密码（函数）**

        - 输入：CPW, CD, N, Ku

        - 返回：NPW

     3. **生成水印参数（函数）**

        - 输入：CWID, NPW, CD, N, Ku, Kw
        - 返回：x, mu, k（水印参数）

  8. #### 后端服务器开发

     1.  **工程结构**

     ![image-20210812213907536](http://www.fishworld.site/media/image.png)

     2. **接口开发**

        - **init**：初始化客户端 GET
          - 返回：PU（公钥）
        - **login**：登录接口 POST
          - 参数：HUN（哈希后的用户名）、CPW（RSA加密后的密码）
          - 返回：msg（确认信息）
        - **register**：注册接口 POST
          - 参数：HUN（哈希后的用户名）、CPW（RSA加密后的密码）
          - 返回：msg（确认信息）
        - **validate**：密码验证接口 POST
          - 参数：HUN（哈希后的用户名）、CPW（RSA加密后的密码）、CWID（RSA加密后的水印ID）
          - 返回：msg（确认信息）

        - **embed**：水印添加参数接口 POST
          - 参数：HUN（哈希后的用户名）、CWID（RSA加密后的水印ID）
          - 返回：加密后的水印参数
        - **extract**：水印提取参数接口 POST

     

- ### 遇到的问题及解决方案：

  1. **问题**：华为云现在应该暂时不支持sgx虚拟化，无法使用secGear框架

     **解决方案**：与华为secGear开发团队联系，由他们提供一台云服务器进行开发

  2. **问题**：secGear框架中加密数据的类型问题

     **解决方案**：原生编写新的数据类，重载一些基础操作

  3. **问题**：secGear框架安全侧编译问题

     **解决方案**：咨询华为secGear开发团队，并且结合sgx和secGear开发实例，对CMAKELISTS进行修改

  4. **问题**：secGear框架运行时间缓慢（15-30s左右）

     **解决方案**：首先，我们认为是创建enclave的时间过长导致，故选择两种方式来解决这个问题。一是一个执行完一个操作安全区不销毁，保留安全区的ID，二是在安全侧写一个不间断地程序，就是监听外部的请求，再选择操作，操作完不停止，继续监听下一个请求。但由于上述两种方案均存在一定问题。后经排查，发现是因为enclave设置的内存过大导致时间缓慢。调整后，时间恢复正常（1s内）

- ### 后续工作安排：

  - #### 8.16-8.31：

    - 基于超混沌序列的水印添加算法实现
    - 基于超混沌序列的水印提取算法实现

  - #### 9.1-9.15：

    - 前端客户端开发
    - 后端服务器优化
    - 数据库开发
    - 服务器与数据库对接

  - #### 9.16-9.30：

    - 前后端对接
    - 测试及调试

    - 撰写报告





